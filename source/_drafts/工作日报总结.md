---
title: 工作日报总结
tags:
---

## 2020-01-06到2019-01-10工作周报
我的优化方法是根据 aduits 面板提供的建议一条一条的优化. 

首先优化的就是性价比最高的图片优化, 适当剪裁, 给图片加上懒加载, 优化完了之后发现除了初始加载资源的数量下降了(从90下降到50), 用户体验的分数并没有提高. 



通过performance 面板上的分析看到我们cpu 峰值的地方, 一是框架代码执行的地方, 这个无法改进, 二是我们dom渲染的地方, 我们的详情页首先会渲染一个骨架图, 但我们骨架图的dom 结构和真实的结构是不同的. 当请求到详情接口后, 需要将整个页面重新渲染一遍. 我想到的一个方法是拆分详情接口, 首先渲染主要内容, 想行程特色, 费用须知可以稍后渲染. 



前端性能优化有两个方面, 一个是渲染优化, 一个是资源下载优化, 说道资源下载优化就想到缓存, 本来想用 application cache, 但发现这个标准已经废弃了, 所以改用推荐的 service work, 和 workbox, workbox 是是servicework 的一个框架. 原生servicework api 很简单, 但是用它写缓存策略是很麻烦的. workbox 中已经有写好的策略, 并且有和打包工具结合的插件.



在实践的过程中碰到两个坑, 其实这两个问题文档中都写的很明白

servicework 只支持https, 本地调试 host 一定要是 localhost 或 127.0.0.1

路由匹配像是`new RegExp('\\.js$')` 只匹配同源下的资源, 不是同源下的资源, 比如cdn下的资源要像 `new RegExp('.+\\.js$')` 这样匹配



还有一些待解决的问题

servicework 比较适合单页面应用, servicework 配置文件要放在网站的网页同源, 现在的解决办法是请求一个同源接口, 接口返回文档流. 但这样更新文件不方便. 朱凯说我我们的火车票就是一个单页面应用, 还用了application cache, 可以问问他们是怎么搞的. 这怎么问呢.

测试中用的是第三方的cdn, google 的cdn 因为墙的原因连不上. 从安全性上考虑也不能用第三方的cdn, 需要将模块打包到文件中.

## 2019-12-30到2019-01-03工作周报
在周一的晨会分享中, 知道了

还是要写ppt, ppt 效果比文档更好, 更直观

开头就要把分享的目的说清楚, 否则听的人不知道本次分享的目的

为了说明新的概念, 最要要有demo



在学习优化性能的过程中

知道了几个测试平台, 使用多个平台测试对比, 效果更好

Lighthouse在构建站点时主要用于本地迭代

pagespeed https://developers.google.com/speed/pagespeed/insights/ 和lighthouse 诊断结果一样, 关键是它有中文报告.

https://www.webpagetest.org/ 可以选不同的地方, 不同的设备

https://tools.pingdom.com/ 报告非常详细

了解了一些详情页可以优化的点

image.png

学习了使用lighthouse 优化一个页面的基本过程 https://developers.google.com/web/tools/chrome-devtools/speed/get-started, 这个还要多多练习.

## 2019-12-23到2019-12-27工作周报
在对比了携程,同程详情页的性能过程中

了解了以用户为中心的性能指标

体验	指标
是否发生？	首次绘制 (FP)/首次内容绘制 (FCP)
是否有用？	首次有效绘制 (FMP)/主角元素计时
是否可用？	可交互时间 (TTI)
是否令人愉快？	耗时较长的任务（在技术上不存在耗时较长的任务）
学习到了跟踪指标的方法

FP/FCP 使用 PerformanceObserver 接口

FMP 首先确定主角元素, 比如视频网站就是播放器, 假如我们的主角元素是一张图片，这时候我们在图片加载出来前先mark一下，然后在onload时间在mark一下，两者再相减，就可以知道我们主角元素出来的用时了

tti 使用ttiPolyfill 

耗时较长的任务 使用PerformanceObserver 接口

了解到自己对解读数据了解不多

了解了携程和同程详情页性能差别的原因, 主要是技术栈导致的, 次要原因是一些实现细节

## 2019-12-02到2019-12-06工作周报
1. 小程序中 wx.getMenuButtonBoundingClientRect, 会经常获取不到胶囊的高度, 后来发现是微信的bug, 需要在page 的 onshow 生命周期中使用才能避免问题 https://developers.weixin.qq.com/community/develop/doc/0006eeb2db0ae022a098c58f85d800?highLine=getMenuButtonBoundingClientRect

2. 周会上老大说的要用数据分析, 我觉得是很有道理的, 比如健身或减肥, 一定要把数据记录下来, 才能有更好的整体把握和推进. 不久前看书看到如何提升代码质量时看到代码复杂度的概念. 发现 vscode 插件有支持复杂度分析的插件  CodeMetrice, 但只支持TS.  github 找到一个 插件https://github.com/ConardLi/awesome-cli/tree//code-complexity 也可以分析代码复杂度. 自己试了一下, 还是可以用的.

## 2019-11-25到2019-11-29工作周报

1. 自动化测试学习总结

vue 官方对自动化测试支持比较好, 小程序也有自动化测试方案, 但不太成熟, 而且学习成本较高.

学习了自动化测试有利于代码组织性的提高, 因为在写代码前就会先想如何测试, 多了一次思考.

自动化测试可以减少回归性bug. 当加了新的需求时, 跑一遍测试, 可以发现是否影响到以前的需求点.

测试文件是潜在的需求文档, 测试文档中的各个测试用例, 基本上说明了代码的作用.


## 2019-11-11到2019-11-15工作周报
1. 旅行币埋点的任务中, 因为任务很简单, 为了凑临传时间, 任务匆匆就上线了, 导致旅行币埋点请求重复发送的问题没有发现, 也没有发现彩娟把其他代码提交到了分支上, 以后不要赶时间了, 对于这种不紧迫的任务, 情愿等上一星期在上线, 也要充分验收.



2. TDD 自学, 这周了解了如何在vue中进行单元测试和集成测试, 了解了一下小程序的测试

vue 如何支持 jest
只要安装一下jest, 在package.json配置一下就可以了

{
  // ...
  "jest": {
    "moduleFileExtensions": [
      &quot",
      "json",
      // 告诉 Jest 处理 `*.vue` 文件
      "vue"
    ],
    "transform": {
      // 用 `vue-jest` 处理 `*.vue` 文件
      ".*\\.(vue)$": "vue-jest"
    }
  }
}
也可以单独写一个配置文件jest.config

使用 vue-test-utils
vue-test-utils 文档非常清晰, vue-test-utils 可以很简单模拟vue 的各种操作, 并没有难度, 但接口较多, 熟练运用需要花时间

小程序单元测试
官方文档 小程序的测试工具集是miniprogram-simulate, 基本操作和 vue-test-utils差不多

总结
测试工具的配置和使用并没有难度, 难的是熟练使用



当初学习自动化测试, 主要是看到群里有极客学院免费的TDD训练营, 而且我也想减少自己的bug数量. 学习了一段时间发现自动化测试并不是万能的, 而且前期需要投入许多的学习成本. 还好, 确实有点用, 虽然还没有运用到实际的开发中,但细化需求时, 首先便会想到把需求细化成可以测试的一个个点. 后面打算先自己练习一下vue的自动化测试. 因为我发现, 如果不熟练写测试而要加入测试, 那会严重影响开发进度. 等到有了一定熟练度后, 我想投入实战看看.